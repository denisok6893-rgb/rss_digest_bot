````md
# CONTINUITY ‚Äî rss_digest_bot

## –ß—Ç–æ —ç—Ç–æ
Telegram-–±–æ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å RSS-–ª–µ–Ω—Ç–∞–º–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–æ–≤–æ—Å—Ç–µ–π.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- `/add` `/list` `/del` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RSS-–∫–∞–Ω–∞–ª–∞–º–∏
- `/sync` ‚Äî —Ä—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π)
- `/news` ‚Äî –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
- `/news week` ‚Äî –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π

–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–Ω–æ–ø–∫–∏:
- üì∞ –°–µ–≥–æ–¥–Ω—è
- üìÖ –ù–µ–¥–µ–ª—è
- ‚ûï –î–æ–±–∞–≤–∏—Ç—å RSS
- üìÉ –ú–æ–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞–≥–ª—É—à–∫–∞)

---

## –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å (–≤–∞–∂–Ω–æ)
–ó–∞–ø—É—Å–∫–∞—Ç—å **—Ç–æ–ª—å–∫–æ** —á–µ—Ä–µ–∑:
```bash
./run.sh
````

–ï—Å–ª–∏ –±–æ—Ç ‚Äú–º–æ–ª—á–∏—Ç‚Äù, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

* —á—Ç–æ –æ–Ω –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ `./run.sh`
* —á—Ç–æ —Å–µ—Ä–≤–∏—Å `rss_digest_bot.service` –∞–∫—Ç–∏–≤–µ–Ω
* —á—Ç–æ –Ω–µ—Ç –≤—Ç–æ—Ä–æ–≥–æ polling-–ø—Ä–æ—Ü–µ—Å—Å–∞

---

## –•—Ä–∞–Ω–∏–ª–∏—â–µ

* SQLite: `data/rss.db` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
* `.env` —Å `BOT_TOKEN`, `SYNC_ALERT_CHAT_ID` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –¥–µ–ø–ª–æ–π

* Python + venv
* –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ `requirements.txt`
* –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä: `/opt/rss_digest_bot`
* –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∂–∏–º: `systemd + polling`
* –∞–≤—Ç–æ-sync: `systemd timer`

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

* –ü—Ä–æ–µ–∫—Ç: `rss_digest_bot`
* –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ä–µ–¥–∞ ‚Äî —Å–µ—Ä–≤–µ—Ä (`/opt/rss_digest_bot`)
* Termux –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ä–∞–Ω—å—à–µ, —Å–µ–π—á–∞—Å —Å–µ—Ä–≤–µ—Ä ‚Äî **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã**

---

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### UI –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è

* –î–æ–±–∞–≤–ª–µ–Ω–æ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å Reply-–∫–Ω–æ–ø–∫–∞–º–∏:

  * üì∞ –°–µ–≥–æ–¥–Ω—è
  * üìÖ –ù–µ–¥–µ–ª—è
  * ‚ûï –î–æ–±–∞–≤–∏—Ç—å RSS
  * üìÉ –ú–æ–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
  * ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
* –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ `app/keyboards/main_menu.py`
* –î–æ–±–∞–≤–ª–µ–Ω—ã `__init__.py` –≤ `app/` –∏ `app/keyboards/`
* `/start`:

  * –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–º
  * –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `handle_menu_buttons`:

  * –∫–Ω–æ–ø–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã
  * –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è `update.message.text` (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω `AttributeError`)

---

### –õ–æ–≥–∏–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π (–∫–ª—é—á–µ–≤–æ–π —Ñ–∏–∫—Å)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ö–Ω–æ–ø–∫–∞ ‚Äú–°–µ–≥–æ–¥–Ω—è‚Äù –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ 0 –∑–∞–ø–∏—Å–µ–π, —Ö–æ—Ç—è sync —Ä–∞–±–æ—Ç–∞–ª.

**–ü—Ä–∏—á–∏–Ω–∞:**
–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —à–ª–∞ –ø–æ `published_at`, –∞ –º–Ω–æ–≥–∏–µ RSS (RB.RU, MIT TR –∏ –¥—Ä.) –ø—É–±–ª–∏–∫—É—é—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞—Ç—ã.

**–†–µ—à–µ–Ω–∏–µ (–í–ê–ñ–ù–û):**

* ‚Äú–°–µ–≥–æ–¥–Ω—è‚Äù –∏ ‚Äú–ù–µ–¥–µ–ª—è‚Äù —Ç–µ–ø–µ—Ä—å —Å—á–∏—Ç–∞—é—Ç—Å—è **–ø–æ `created_at`**, –∞ –Ω–µ –ø–æ `published_at`
* –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

  * ‚Äú–°–µ–≥–æ–¥–Ω—è‚Äù = *—á—Ç–æ –±–æ—Ç —Å–∫–∞—á–∞–ª —Å–µ–≥–æ–¥–Ω—è*
  * ‚Äú–ù–µ–¥–µ–ª—è‚Äù = *—á—Ç–æ —Å–∫–∞—á–∞–Ω–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π*

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

* üì∞ –°–µ–≥–æ–¥–Ω—è –∏ üìÖ –ù–µ–¥–µ–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç
* –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `get_today_news()` –∏ `get_week_news()`

---

### –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `telegram.error.BadRequest: Message is too long`
* –û—Ç–≤–µ—Ç—ã `/news` —Ç–µ–ø–µ—Ä—å:

  * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ **—Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏**
  * –±–µ–∑–æ–ø–∞—Å–Ω—ã –¥–ª—è Telegram (–ª–∏–º–∏—Ç ~4096 —Å–∏–º–≤–æ–ª–æ–≤)

---

### –ê–≤—Ç–æ-sync –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

* –ù–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ-sync —á–µ—Ä–µ–∑ systemd:

  * —Å–µ—Ä–≤–∏—Å: `rss_digest_bot_sync.service`
  * —Ç–∞–π–º–µ—Ä: `rss_digest_bot_sync.timer` (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω CLI-—Ä–µ–∂–∏–º:

```bash
python -m app.main sync
```

* CLI-sync:

  * **–Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç polling**
  * –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã—Ö–æ–¥–∏—Ç (`exit-code 0/1`)
  * –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è Telegram API

---

### –ó–∞—â–∏—Ç–∞ –æ—Ç –±–∏—Ç—ã—Ö RSS

–í —Ç–∞–±–ª–∏—Ü—É `subscriptions` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:

* `fail_count`
* `disabled`
* `last_error`

–õ–æ–≥–∏–∫–∞:

* –ø—Ä–∏ –æ—à–∏–±–∫–µ RSS ‚Üí `fail_count += 1`
* –ø—Ä–∏ `fail_count >= SYNC_MAX_FAILS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5):

  * –ø–æ–¥–ø–∏—Å–∫–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è `disabled=1`
  * –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Telegram-–∞–ª–µ—Ä—Ç
* disabled-–ø–æ–¥–ø–∏—Å–∫–∏ **–ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–∏ sync**

---

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### Sync-–ª–æ–≥

–§–∞–π–ª:

```
/opt/rss_digest_bot/logs/sync.log
```

–§–æ—Ä–º–∞—Ç:

```
[YYYY-MM-DD HH:MM:SS] start users=<N> feeds=<N>
[YYYY-MM-DD HH:MM:SS] done new_entries=<N> errors=<N> duration_sec=<X>
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
tail -n 20 /opt/rss_digest_bot/logs/sync.log
```

#### –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤

* –Ω–∞—Å—Ç—Ä–æ–µ–Ω `logrotate`
* —Ñ–∞–π–ª: `/etc/logrotate.d/rss_digest_bot`
* –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

  * –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è
  * —Ö—Ä–∞–Ω–µ–Ω–∏–µ 14 –¥–Ω–µ–π
  * `compress`, `delaycompress`
  * `copytruncate`

---

### –ê–≤—Ç–æ-alert (systemd)

* CLI-sync –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `exit-code=1` –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
* systemd –ø–æ–º–µ—á–∞–µ—Ç –∑–∞–ø—É—Å–∫ –∫–∞–∫ FAILED
* –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:

  * –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
  * –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ RSS
* —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–µ–¥—É–ø –∞–ª–µ—Ä—Ç–æ–≤ (–Ω–µ —Å–ø–∞–º–∏—Ç)

---

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

* –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
* –∫–Ω–æ–ø–∫–∏ ‚Äú–°–µ–≥–æ–¥–Ω—è‚Äù –∏ ‚Äú–ù–µ–¥–µ–ª—è‚Äù —Ä–∞–±–æ—Ç–∞—é—Ç
* sync –ø–∏—à–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î
* –¥–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–µ–∂—É—Ç—Å—è
* –∞–≤—Ç–æ-sync –∏ –∞–≤—Ç–æ-alert –∞–∫—Ç–∏–≤–Ω—ã
* systemd —Å–µ—Ä–≤–∏—Å—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è / –¥–æ–ª–≥–∏

* ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî –∑–∞–≥–ª—É—à–∫–∞
* –Ω–µ—Ç `/news month`
* —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å—Ç—å, –Ω–æ –Ω–µ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ UI
* –Ω–µ—Ç –∞–≤—Ç–æ-–ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–æ–≤–æ—Å—Ç–µ–π (–ø–æ–∫–∞)

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# —Ä—É—á–Ω–æ–π sync
python -m app.main sync

# –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
systemctl status rss_digest_bot.service
systemctl status rss_digest_bot_sync.timer

# –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
sqlite3 data/rss.db
```

---

## –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ (–æ–¥–∏–Ω)

–î–æ–±–∞–≤–∏—Ç—å **—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ RSS –ø–æ –ò–ò** (OpenAI / Anthropic / DeepSeek / Cursor)
–∏ –∑–∞—Ç–µ–º ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è sync-–ª–æ–≥–∏–∫–∏.

```
::contentReference[oaicite:0]{index=0}
```
